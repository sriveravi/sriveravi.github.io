<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of codeFixationsDist</title>
  <meta name="keywords" content="codeFixationsDist">
  <meta name="description" content="identify fixations">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../index.html">Home</a> &gt;  <a href="index.html">GVSToolbox</a> &gt; codeFixationsDist.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../index.html"><img alt="<" border="0" src="../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for GVSToolbox&nbsp;<img alt=">" border="0" src="../right.png"></a></td></tr></table>-->

<h1>codeFixationsDist
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>identify fixations</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>function [ fixStruct ] = codeFixationsDist( eyeTrack, windowSize, viewThreshold ) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre class="comment"> identify fixations
 June 22, 2011
 Notes: This function codes the eye track sequence according to the fixations
   It checks to make sure that the fixation is not immediately at start of
   sequence (from fixation slide) and eliminates this fixation if necessary
   We identify fixations using the IDT algorithm
 
 syntax: [ fixStruct ]  = codeFixations( eyeTrack, windowSize, viewThreshold )
 
 Inputs: 
       eyeTrack: vector  of complex (x+i*y) coordinates.  -1-i1  to identify
           missing data. Data should be scaled according to the image dimensions.  
           See function 'scaleEyeTrack'.
       windowSize: integer of consecutive frames which should be within a
           threshold of distance from one another (to be considered a
           fixation) , ( 6 is good value for 60 Hz)
       viewThreshold: euclidean distance within which eye positions are
           considered part of same fixation, 15 is a good number for 30 px
           diameter
  
 Outputs:
       fixStruct, having 
       fixStruct.fixDurVector: vector of (fx1),  for duration of fications
       fixStruct.fixPosVector: in format [ x x x ... x; 
                                                          y y y ... y]
       fixStruct.fixationVector: (N by1) vector having 0 where no fixations, then 1, 2 ,3,
           and so on for the fixations in the sequence</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="calc2Dist.html" class="code" title="function dist = calc2Dist( target, query)">calc2Dist</a>	Notes: calculates 2-norm distance from target vector to all query vectors</li></ul>
This function is called by:
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="extractVarsDist.html" class="code" title="function [ featureVect,  varParams ] = extractVarsDist( trackCell, aoiPositions, maxDist, relevantAOIs, varParams )">extractVarsDist</a>	extract all variables from a cell of eye tracks</li><li><a href="visualizeTrackDist.html" class="code" title="function visualizeTrackDist(  leftEyePos, leftOri, imgFile, varParams, stimSize )">visualizeTrackDist</a>	visualize the gaze data</li></ul>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="#_sub1" class="code">function [fixIndex, fixPosition, fixLength] = findFixation(  eyeTrack, windowSize, viewThreshold, startPos )</a></li></ul>

<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre>0001 <span class="comment">% identify fixations</span>
0002 <span class="comment">% June 22, 2011</span>
0003 <span class="comment">% Notes: This function codes the eye track sequence according to the fixations</span>
0004 <span class="comment">%   It checks to make sure that the fixation is not immediately at start of</span>
0005 <span class="comment">%   sequence (from fixation slide) and eliminates this fixation if necessary</span>
0006 <span class="comment">%   We identify fixations using the IDT algorithm</span>
0007 <span class="comment">%</span>
0008 <span class="comment">% syntax: [ fixStruct ]  = codeFixations( eyeTrack, windowSize, viewThreshold )</span>
0009 <span class="comment">%</span>
0010 <span class="comment">% Inputs:</span>
0011 <span class="comment">%       eyeTrack: vector  of complex (x+i*y) coordinates.  -1-i1  to identify</span>
0012 <span class="comment">%           missing data. Data should be scaled according to the image dimensions.</span>
0013 <span class="comment">%           See function 'scaleEyeTrack'.</span>
0014 <span class="comment">%       windowSize: integer of consecutive frames which should be within a</span>
0015 <span class="comment">%           threshold of distance from one another (to be considered a</span>
0016 <span class="comment">%           fixation) , ( 6 is good value for 60 Hz)</span>
0017 <span class="comment">%       viewThreshold: euclidean distance within which eye positions are</span>
0018 <span class="comment">%           considered part of same fixation, 15 is a good number for 30 px</span>
0019 <span class="comment">%           diameter</span>
0020 <span class="comment">%</span>
0021 <span class="comment">% Outputs:</span>
0022 <span class="comment">%       fixStruct, having</span>
0023 <span class="comment">%       fixStruct.fixDurVector: vector of (fx1),  for duration of fications</span>
0024 <span class="comment">%       fixStruct.fixPosVector: in format [ x x x ... x;</span>
0025 <span class="comment">%                                                          y y y ... y]</span>
0026 <span class="comment">%       fixStruct.fixationVector: (N by1) vector having 0 where no fixations, then 1, 2 ,3,</span>
0027 <span class="comment">%           and so on for the fixations in the sequence</span>
0028 
0029 
0030 <a name="_sub0" href="#_subfunctions" class="code">function [ fixStruct ] = codeFixationsDist( eyeTrack, windowSize, viewThreshold )</a>
0031 
0032     <span class="keyword">if</span> nargin &lt; 2
0033         windowSize = 6;
0034     <span class="keyword">end</span>
0035     <span class="keyword">if</span> nargin &lt; 3
0036         viewThreshold = 15;
0037     <span class="keyword">end</span>
0038 
0039     numSamples =  length( eyeTrack);
0040     fixationVector = zeros(numSamples ,1);  
0041     fixDurVector = zeros(numSamples ,1);  
0042     fixPosVector = zeros( 2, numSamples );
0043     startPos = 1; 
0044 
0045     fixIndex = 1;  fixLength = 0; k1 = 1;
0046     <span class="keyword">while</span>  ( fixIndex~=-1 ) &amp;&amp; (startPos &lt; numSamples ) 
0047         <span class="comment">%     [k1 fixIndex fixLength]</span>
0048         [fixIndex fixPosition fixLength] = <a href="#_sub1" class="code" title="subfunction [fixIndex, fixPosition, fixLength] = findFixation(  eyeTrack, windowSize, viewThreshold, startPos )">findFixation</a>(  eyeTrack, windowSize, viewThreshold, startPos );
0049         startPos = fixIndex + fixLength;
0050         <span class="keyword">if</span>  fixIndex~=-1 
0051             fixationVector( fixIndex:(fixIndex+fixLength-1)) = k1;
0052             fixPosVector(:,k1 ) = fixPosition(:);
0053             fixDurVector(k1,1) = fixLength;
0054             k1 = k1+1;
0055         <span class="keyword">end</span>
0056         
0057     <span class="keyword">end</span>
0058     fixPosVector(:,k1:end) = []; <span class="comment">%clean up unused parts</span>
0059     fixDurVector( k1+1:end) = [];
0060     
0061     
0062     <span class="comment">% eliminate first fixation if it coincides with the</span>
0063     <span class="comment">% fixation slide ( start of sequence)</span>
0064     <span class="keyword">if</span> fixationVector(1) == 1
0065         fixationVector( fixationVector==1) = 0;
0066         fixationVector( fixationVector ~= 0 ) = fixationVector( fixationVector ~= 0 )-1;
0067         fixPosVector( :,1) = [];
0068         fixDurVector(1) = [];
0069     <span class="keyword">end</span>
0070 
0071     fixStruct.fixPosVector = fixPosVector;
0072     fixStruct.fixDurVector = fixDurVector;
0073     fixStruct.fixationVector = fixationVector;
0074     
0075 <span class="keyword">end</span>
0076 <span class="comment">%---------------------------------------------------</span>
0077 
0078 <span class="comment">% Outputs:</span>
0079 <span class="comment">%      fixIndex: integer index for beginning of fixation. -1 if none found</span>
0080 <span class="comment">%      fixPosition: vector of the fixation position (mean of the window) -1 if none found</span>
0081 <span class="comment">%      fixLength: : integer specifying total length of fixation, -1 if none found</span>
0082 
0083 <a name="_sub1" href="#_subfunctions" class="code">function [fixIndex, fixPosition, fixLength] = findFixation(  eyeTrack, windowSize, viewThreshold, startPos )</a>
0084 
0085     <span class="comment">%--------------------------------------------------------</span>
0086     <span class="comment">%--------------- initialize -----------------------</span>
0087 
0088     minTracksToConsider = floor( 2/3 * windowSize ); <span class="comment">% integer, specifying minimum samples</span>
0089                                                                                  <span class="comment">%   tracked when calculating fixation</span>
0090     eyeTrack =  [ real( eyeTrack(:)) imag(eyeTrack(:)) ]'; <span class="comment">% in [ x x ... x; y y ... y ]</span>
0091     maxPos = size( eyeTrack,2) - windowSize+1;
0092     fixPosition = -1; fixLength = -1;
0093     fixIndex = -1; <span class="comment">% will stay -1 if none found</span>
0094 
0095     <span class="comment">% specify search start position</span>
0096     <span class="keyword">if</span> nargin &lt; 4 || isempty( startPos )   
0097         i1 = 0;
0098     <span class="keyword">else</span>
0099         i1 =  startPos-1;
0100     <span class="keyword">end</span>
0101 
0102     <span class="comment">%--------------------------------------------------------</span>
0103     <span class="comment">%-----------find fixation position --------------------------</span>
0104 
0105     <span class="keyword">while</span> (i1 &lt; maxPos) &amp;&amp; (fixIndex==-1)
0106 
0107         <span class="comment">%increment, until start with not missing if necessary</span>
0108          i1 =  i1+1;     
0109         <span class="keyword">while</span> (i1 &lt; maxPos) &amp;&amp; (eyeTrack(1,i1)==-1) 
0110             i1 =  i1+1; 
0111         <span class="keyword">end</span>
0112 
0113         <span class="comment">% select window of windowSize samples, expand if</span>
0114         <span class="comment">% too much missing data or if last sample is missing</span>
0115         i2 = 0; <span class="comment">%for expanding window</span>
0116         window = eyeTrack(:, i1:(i1+windowSize-1));
0117         missIdx = find( window(1,:) == -1 );
0118         window( :, missIdx ) = [];
0119         <span class="comment">% old way</span>
0120 <span class="comment">%         window( window==-1) = [];</span>
0121 <span class="comment">%         window = reshape( window, 2,[]);</span>
0122         <span class="keyword">while</span> ( (size( window,2) &lt; minTracksToConsider ) || <span class="keyword">...</span>
0123                     (eyeTrack(1, i1+windowSize-1+i2)==-1)  ) <span class="keyword">...</span>
0124                      &amp;&amp; (i1+i2)&lt;maxPos  <span class="comment">% do not expand too far</span>
0125             i2 = i2+1;
0126             window = eyeTrack(:, i1:(i1+windowSize-1+i2));
0127             missIdx = find( window(1,:) == -1 );
0128             window( :, missIdx ) = [];
0129             <span class="comment">% old way</span>
0130     <span class="comment">%         window( window==-1) = [];</span>
0131     <span class="comment">%         window = reshape( window, 2,[]);</span>
0132         <span class="keyword">end</span>
0133 
0134         <span class="comment">% determine if fixation based on viewThreshold</span>
0135 
0136         <span class="comment">%         window = reshape( window, 2,[]);</span>
0137         <span class="keyword">if</span> size( window,2) &gt;= minTracksToConsider <span class="comment">%handle missing data</span>
0138             
0139             <span class="comment">%         dist = ( repmat(mean(window,2),1,size(window,2)) - window);</span>
0140             <span class="comment">%         dist = sqrt(sum(dist.^2,1));</span>
0141             dist = <a href="calc2Dist.html" class="code" title="function dist = calc2Dist( target, query)">calc2Dist</a>( mean(window,2), window); <span class="comment">%euclidean distance from mean to all</span>
0142             <span class="keyword">if</span> max( dist ) &lt; viewThreshold
0143                 fixIndex = i1; <span class="comment">%store fixation position</span>
0144                 fixPosition =  mean(window,2);
0145             <span class="keyword">end</span>        
0146         <span class="keyword">end</span>    
0147 
0148     <span class="keyword">end</span>
0149 
0150     <span class="comment">%---------------------------------------------------------</span>
0151     <span class="comment">%-----------find fixation duration ( if fixation found)------------</span>
0152 
0153     <span class="keyword">if</span>  fixIndex ~= -1
0154 
0155         <span class="comment">% initialize for keeping track/convenience</span>
0156         eyeTrack(:,1:fixIndex-1) = [];
0157         missingIndices = 1:size(eyeTrack,2);
0158         knownIndices = missingIndices( eyeTrack(1,:)~=-1);
0159         missingIndices( eyeTrack(1,:)~=-1) = [];
0160         eyeTrack( :, missingIndices) = [];  
0161 
0162          <span class="comment">% find furthest index within threshold distance</span>
0163          dist = <a href="calc2Dist.html" class="code" title="function dist = calc2Dist( target, query)">calc2Dist</a>( fixPosition, eyeTrack);
0164          i1 =1;
0165          <span class="keyword">while</span>  (i1&lt;=length(dist)) &amp;&amp; (dist(i1) &lt; viewThreshold) 
0166              i1 = i1+1; 
0167          <span class="keyword">end</span>;      
0168          fixLength = knownIndices(i1-1);
0169 
0170     <span class="keyword">end</span>
0171 
0172 <span class="keyword">end</span></pre></div>
<hr><address>Generated on Tue 01-Jul-2014 12:35:04 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>